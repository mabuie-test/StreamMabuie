
<!doctype html>
<html>
<head><meta charset="utf-8"><title>Painel</title><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="stylesheet" href="/styles.css"></head>
<body>
  <div class="container">
    <h2>Painel</h2>
    <div>
      <input id="newDevice" class="input" placeholder="Device ID"><button id="addBtn" class="btn">Adicionar</button>
      <button id="logout" class="btn">Logout</button>
    </div>
    <div id="grid" class="grid"></div>
  </div>
<script>
(async ()=>{
  const token = localStorage.getItem('token');
  if (!token) return location.href='/login.html';
  document.getElementById('logout').onclick = ()=>{ localStorage.removeItem('token'); location.href='/login.html'; };
  document.getElementById('addBtn').onclick = async ()=> {
    const id = document.getElementById('newDevice').value.trim(); if(!id) return alert('preenche');
    const r = await fetch('/api/device/add', { method:'POST', headers:{ 'Content-Type':'application/json', 'Authorization':'Bearer '+token }, body: JSON.stringify({ deviceId: id })});
    if (!r.ok) return alert('erro');
    load();
  };
  async function load(){
    const r = await fetch('/api/devices', { headers: { 'Authorization': 'Bearer ' + token }});
    if (!r.ok) return alert('erro a carregar');
    const j = await r.json();
    const grid = document.getElementById('grid'); grid.innerHTML = '';
    for(const d of j.devices){
      const c = document.createElement('div'); c.className='card';
      const h = document.createElement('h4'); h.innerText = d.deviceId;
      const img = document.createElement('img'); img.src = '/stream/' + encodeURIComponent(d.deviceId); img.className='thumb';
      c.appendChild(h); c.appendChild(img);
      grid.appendChild(c);
    }
  }
  load();
})();
</script>
</body>
</html>
